# 版本更新日志

## [0.3.0] - 2026-02-03

### 新功能

- **批量查询模式**
  - 支持从JSON文件批量导入问题
  - 并发处理多个查询（最多3个并发）
  - 生成结构化的批量查询报告
  - 支持失败重试机制

- **外部Agent调用重试机制**
  - 支持配置文件定义重试策略（是否启用、自动重试、最大重试次数）
  - 支持自动重试和交互式重试两种模式
  - 支持超时和错误的独立重试控制
  - 支持指数退避策略（可选）
  - 重试日志记录完整准确

- **智能工具选择器**
  - 根据问题类型自动选择最适合的工具
  - 实现工具性能评分和推荐机制
  - 支持工具使用统计和优化建议
  - 工具选择准确率目标≥80%

- **性能监控和统计**
  - 实时监控系统性能指标（响应时间、内存使用、CPU使用率）
  - 生成性能统计报告
  - 支持性能趋势分析
  - 提供性能告警功能

- **测试覆盖率提升**
  - 将测试覆盖率从73.70%提升至80%以上
  - 分析未覆盖的代码路径
  - 编写针对性的单元测试
  - 集成覆盖率报告到CI/CD

---

## [0.2.1] - 2026-02-01

### 修复

- **CI/CD 改进**
  - 添加 develop 分支支持，CI/CD 现在推送到 develop 分支时自动触发
  - 修复虚拟环境创建问题，确保 `uv run` 命令正常工作
  - 修复目录创建竞态条件，使用 `exist_ok=True` 避免并发问题
  - 修复 Windows PowerShell 语法错误，将多行命令改为单行格式
  - 移除 macOS 平台测试，避免 llama-cpp-python 安装问题
  - 修复 build-verify 作业，添加虚拟环境创建步骤
  - 修复 build 命令调用，使用 `python -m build` 而不是 `build`

- **日志系统修复**
  - 修复日志目录创建逻辑，避免 `FileExistsError` 错误

---

## [0.2.0] - 2025-01-31

### 新功能

- **统一的 CI/CD 脚本**
  - 整合原有的 ci.py 和 cd.py 功能到单一脚本
  - 支持三种执行模式：ci（持续集成）、cd（持续部署）、all（完整流程）
  - 统一配置管理，支持通过配置文件自定义参数
  - 跨平台支持（Windows、Linux、macOS）

- **代码质量改进**
  - 完善类型注解，所有函数/方法包含完整类型标注
  - 修复所有 mypy 类型检查错误（11个）
  - 修复所有 ruff 代码规范问题
  - 代码格式统一使用 ruff

- **测试覆盖率支持**
  - 集成 pytest-cov 生成覆盖率报告
  - 支持 XML 和 HTML 格式覆盖率报告
  - 默认覆盖率阈值设置为 70%
  - 当前测试覆盖率达到 73.70%

- **安全检查集成**
  - 集成 bandit 进行安全扫描
  - 生成 JSON 格式安全报告
  - 在 CI/CD 流程中自动执行

### 改进

- **依赖管理优化**
  - 使用 uv 作为统一依赖管理工具
  - 支持 CI 环境和本地开发环境
  - 优化依赖安装速度

- **报告功能增强**
  - 支持多种报告格式（TEXT、MARKDOWN、HTML、JSON、PDF）
  - PDF 生成支持（通过 weasyprint）
  - 改进报告内容结构和可读性

- **缓存机制完善**
  - LLM 响应缓存
  - 工具执行结果缓存
  - 支持缓存过期和清理策略

- **历史记录功能**
  - 完善会话历史记录
 保存查询和响应记录
  - 支持历史记录查询和导出

### 修复

- **类型检查修复**
  - 修复 cache_manager.py 中的类型注解问题
  - 修复 history_manager.py 中的 SQL 参数类型问题
  - 修复 report_generator.py 中的内容类型问题
  - 修复 multi_format_reporter.py 中的联合类型处理

- **代码规范修复**
  - 修复行长度超过 88 字符的问题
  - 移除未使用的变量和导入
  - 修复裸 except 语句，使用具体异常类型
  - 修复 SQL 字符串拼接，使用参数化查询

- **CI/CD 脚本修复**
  - 修复 cmd.append.append() 重复调用错误
  - 修复不必要的 f-string 使用
  - 修复 mypy strict 模式下的 type ignore 注释问题

### 技术变更

- **Python 版本要求**
  - 最低版本：Python 3.12
  - 最高版本：Python 3.12（不兼容 3.13）

- **依赖更新**
  - 新增 pytest-cov>=7.0.0（覆盖率测试）
  - 新增 bandit>=1.9.2（安全检查）
  - 更新 pytest-mock>=3.14.0
  - 更新 ruff>=0.5.5
  - 更新 mypy>=1.9.0

- **配置文件优化**
  - pyproject.toml 添加完整的 mypy 配置
  - 支持 mypy strict 模式（可选）
  - 配置 warn_unused_ignores = false 以兼容可选依赖
  - 添加 weasyprint 模块的 mypy 覆盖

### 文档更新

- **新增文档**
  - Scripts/cd_usage.md：CI/CD 脚本使用说明
  - 更新 README.md（如有需要）

- **文档改进**
  - 完善项目规则文档
  - 添加 CI/CD 流程说明
  - 添加版本发布规范

### 兼容性说明

- **向后兼容**
  - 保持现有 API 接口不变
  - 保持数据库结构兼容
  - 保持配置文件格式兼容

- **迁移指南**
  - 如需从旧版本迁移，请更新依赖
  - 建议使用 uv 重新安装依赖
  - 检查 pyproject.toml 配置是否完整

### 已知问题

- **PDF 生成**
  - 需要安装 weasyprint（可选依赖）
  - 如未安装，会自动降级为 HTML 格式

- **测试覆盖率**
  - 当前覆盖率为 73.70%，略高于 70% 阈值
  - 建议继续提高覆盖率到 80% 以上

### 升级建议

1. **依赖安装**
   ```bash
   # 使用 uv 重新安装依赖
   uv sync
   ```

2. **配置检查**
   ```bash
   # 验证 pyproject.toml 配置
   uv run mypy src/
   ```

3. **运行测试**
   ```bash
   # 运行完整测试套件
   uv run pytest tests/ -v
   ```

4. **运行 CI/CD**
   ```bash
   # 运行完整的 CI/CD 流程
   python Scripts/cicd.py
   ```

---

## [0.1.0] - 2025-01-XX

### 初始版本

- 项目基础架构搭建
- 核心功能实现
- 基础测试覆盖
